# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices/configuration.html#application-related-configuration
parameters:

services:
  app.cache:
    class: Symfony\Component\Cache\Simple\FilesystemCache
    arguments:
      - 'app'
      - 0
      - '%kernel.cache_dir%'

  app.oauth_consumer:
    class: MediaWiki\OAuthClient\Consumer
    arguments:
      - '%env(OAUTH_CONSUMER_KEY)%'
      - '%env(OAUTH_CONSUMER_SECRET)%'

  app.oauth_client_config:
    class: MediaWiki\OAuthClient\ClientConfig
    arguments:
      - '%env(OAUTH_ENDPOINT)%'
    calls:
      - [setConsumer, ['@app.oauth_consumer']]

  app.oauth_client:
    class: MediaWiki\OAuthClient\Client
    arguments:
      - '@app.oauth_client_config'
    calls:
      - [setCallback, ["@=service('request_stack').getMasterRequest().getUriForPath('/login')"]]

  app.mediawiki_client:
    class: GuzzleHttp\Client
    arguments:
      -
        base_uri: '%env(MEDIAWIKI_API_URL)%'

  app.event.jwt_created_listener:
      class: App\EventListener\JWTCreatedEventListener
      tags:
          -
            name: kernel.event_listener
            event: lexik_jwt_authentication.on_jwt_created
            method: onJWTCreated

  app.controller_auth:
    class: App\Controller\AuthController
    arguments:
      - '@app.cache'
      - '@app.mediawiki_client'
      - '@app.oauth_client'
      - '@security.token_storage'
      - '@lexik_jwt_authentication.jwt_manager'
      - '@doctrine'

  app.controller_takedown:
    class: App\Controller\TakedownController
    arguments:
      - '@serializer'
      - '@doctrine'

  app.return_listener:
    class: GeoSocio\SerializeResponse\EventListener\KernelViewListener
    arguments:
        - '@serializer'
        - '@serializer'
        - '@security.token_storage'
    tags:
        - { name: kernel.event_listener, event: kernel.view }
